# Daily Log - September 8, 2025

## What did I work on today?

### Iden3 Identity Stack Deployment for Puppynet

Spent the entire day working on deploying the iden3-contracts identity stack to on Puppynet network:

- **Puppynet** (Chain ID: 157) - Shibarium testnet

## What did I learn?

### 1. **Hardhat Ignition Deployment Issues**

- **Problem**: Encountered "Invariant violated: neither timeouts or failures" error
- **Root Cause**: Empty string parameters in deployment configuration causing contract validation failures
- **Solution**: Properly configured all required addresses (oracle signing addresses, proxy admin owners)

### 2. **CreateX Factory Configuration**

- **Issue**: CreateX factory was deployed at custom address `0x49b80787E663e4FE18A3d91e5a70bfD317e2834b` on Puppynet instead of expected `0xba5ed099633d3b313e4d5f7bdc1305d3c28ba5ed`
- **Learning**: Hardhat Ignition create2 strategy doesn't support custom factory addresses in current version
- **Workaround**: Deployment falls back to basic strategy when create2 fails

- The above issue occured, as I did not give full attention to the deployment of CreateX, it can be deployed by following the steps (listed here)[https://github.com/pcaversaccio/createx], I will deploy this tomorrow.

### 3. **Multi-Compiler Version Configuration**

- **Problem**: Contract verification failing with "Etherscan only supports compiler versions 0.4.11 and higher"
- **Solution**: Added multiple Solidity compiler versions (0.4.11, 0.5.17, 0.6.11, 0.8.27) to support all contract types
- **Key Insight**: Different contracts in the identity stack may require different compiler versions

### 4. **Network Configuration Setup**

- Successfully configured puppynet network with proper:
  - RPC URLs and chain IDs
  - Etherscan API configurations (Puppyscan & Shibariumscan)
  - Gas settings and account management
  - Oracle signing addresses using production values

### 5. **Identity Stack Architecture Understanding**

- **Core Components**: State contracts, Universal Verifier, Identity Tree Store
- **Validators**: MTP, Signature, V3, Linked Multi-Query, Auth V2, ETH Identity
- **Libraries**: Poseidon hash functions, SMT (Sparse Merkle Tree) libraries
- **Cross-chain**: Proof validators with oracle integration
- **CreateX**: For safely deploying contracts using CREATE, CREATE2 & CREATE3

  - First, you need to deploy CreateX
  - Secondly, update ignition/modules/params/<chainid.json> by referring any existing file in the same directory of a different chain
  - Thirdly, make use of the below 2 commands to complete the deployment:

  ```bash
  npx hardhat run scripts/deploy/deployment-step-1/deploySystem.ts --network <network>

  npx hardhat run scripts/deploy/deployment-step-2/deploySystem.ts --network <network>
  ```

## Any blockers?

### Resolved Blockers:

1. ✅ **Empty Configuration Values**: Fixed by populating all required addresses
2. ✅ **Compiler Version Compatibility**: Resolved by adding multiple compiler versions
3. ✅ **Corrupted Deployment State**: Fixed by clearing deployment artifacts and restarting

### Current Status:

- **Puppynet**: Successfully deployed and configured with all contract addresses populated (will redeploy tomorrow with proper deployment of CreateX)
- **Shibarium**: Configuration files created and ready for deployment
- **Verification**: Should now work with multiple compiler version support

## Technical Details Learned:

### Configuration Files Structure:

- `ignition/modules/params/chain-{chainId}.json` contains network-specific deployment parameters
- Key sections: proxy admin owners, contract addresses, oracle configurations
- Must have proper addresses (no empty strings) for deployment to succeed

### Hardhat Configuration:

- Multiple Solidity compilers can be configured for different contract requirements
- Network-specific configurations for gas, accounts, and verification
- Custom chains need explicit Etherscan API configuration

### Identity Stack Deployment Process:

1. Deploy utility contracts (Poseidon, SMT libraries)
2. Deploy core state management contracts
3. Deploy validator contracts for different proof types
4. Configure cross-chain proof validation
5. Verify all contracts on block explorer

## Next Steps:

- Complete any remaining verifications on Puppynet
- Deploy to Shibarium mainnet using prepared configuration
- Test cross-chain functionality between networks
- Document deployment addresses for integration teams
